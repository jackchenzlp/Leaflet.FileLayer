!function(){const e=L.Layer.extend({options:{layer:L.geoJson,layerOptions:{},fileSizeLimit:1024},initialize:function(e,t){this._map=e,L.Util.setOptions(this,t),this._parsers={geojson:this._loadGeoJSON,json:this._loadGeoJSON,gpx:this._convertToGeoJSON,kml:this._convertToGeoJSON}},load:function(e,t){var i,o;return!this._isParameterMissing(e,"file")&&!!this._isFileSizeOk(e.size)&&!!(i=this._getParser(e.name,t))&&((o=new FileReader).onload=L.Util.bind((function(t){var o;try{this.fire("data:loading",{filename:e.name,format:i.ext}),o=i.processor.call(this,t.target.result,i.ext),this.fire("data:loaded",{layer:o,filename:e.name,format:i.ext})}catch(e){this.fire("data:error",{error:e})}}),this),e.testing||o.readAsText(e),o)},loadMultiple:function(e,t){let i=[];if(e[0])for(e=Array.prototype.slice.apply(e);e.length>0;)i.push(this.load(e.shift(),t));return i},loadData:function(e,t,i){var o,r;if(!this._isParameterMissing(e,"data")&&!this._isParameterMissing(t,"name")&&this._isFileSizeOk(e.length)&&(o=this._getParser(t,i)))try{this.fire("data:loading",{filename:t,format:o.ext}),r=o.processor.call(this,e,o.ext),this.fire("data:loaded",{layer:r,filename:t,format:o.ext})}catch(e){this.fire("data:error",{error:e})}},_isParameterMissing:function(e,t){return void 0===e&&(this.fire("data:error",{error:new Error(`Missing parameter:${t}`)}),!0)},_getParser:function(e,t){var i;if(t=t||e.split(".").pop(),i=this._parsers[t])return{processor:i,ext:t};this.fire("data:error",{error:new Error(`Unsupported file type (${t})`)})},_isFileSizeOk:function(e){var t=(e/1024).toFixed(4);return!(t>this.options.fileSizeLimit&&(this.fire("data:error",{error:new Error(`File size exceeds limit (${t} > ${this.options.fileSizeLimit} 'kb)`)}),1))},_loadGeoJSON:function(e){var t;if("string"==typeof e&&(e=JSON.parse(e)),0===(t=this.options.layer(e,this.options.layerOptions)).getLayers().length)throw new Error("GeoJSON has no valid layers.");return this.options.addToMap&&t.addTo(this._map),t},_convertToGeoJSON:function(e,t){"string"==typeof e&&(e=(new window.DOMParser).parseFromString(e,"text/xml"));const i=toGeoJSON[t](e);return this._loadGeoJSON(i)}}),t=L.Control.extend({options:{title:"Load local file (GPX, KML, GeoJSON)",position:"topleft",fitBounds:!0,layerOptions:{},addToMap:!0,fileSizeLimit:1024},initialize:function(e){L.Util.setOptions(this,e),this.loader=null},onAdd:function(e){return this.loader=L.FileLayer.fileLoader(e,this.options),this.loader.on("data:loaded",(function(t){this.options.fitBounds&&window.setTimeout((function(){e.fitBounds(t.layer.getBounds())}),500)}),this),this._initDragAndDrop(e),e.FileControl=this,this._createIcon()},_createIcon:function(){const e=this.loader;let t;const i="leaflet-control-filelayer leaflet-control-zoom",o="leaflet-bar",r=`${o}-part`,n=L.DomUtil.create("div",`${i}  ${o}`),a=L.DomUtil.create("a",`${i} -in ${r}`,n);return this.options.title&&(a.title=this.options.title),document.getElementById("browser-file-css")||this._appendControlStyles(n),a.href="#",t=L.DomUtil.create("input","hidden",n),t.type="file",t.multiple="multiple",this.options.formats?t.accept=this.options.formats.join(","):t.accept=".gpx,.kml,.json,.geojson",t.style.display="none",t.addEventListener("change",(function(){e.loadMultiple(this.files),this.value=""}),!1),L.DomEvent.disableClickPropagation(n),L.DomEvent.on(a,"click",(function(e){t.click(),e.preventDefault()})),n},_initDragAndDrop:function(e){var t,i=this.loader,o=e._container,r={dragenter:function(){e.scrollWheelZoom.disable()},dragleave:function(){e.scrollWheelZoom.enable()},dragover:function(e){e.stopPropagation(),e.preventDefault()},drop:function(t){t.stopPropagation(),t.preventDefault(),i.loadMultiple(t.dataTransfer.files),e.scrollWheelZoom.enable()}};for(t in r)r.hasOwnProperty(t)&&o.addEventListener(t,r[t],!1)},_appendControlStyles:function(e){var t=document.createElement("style");t.setAttribute("type","text/css"),t.id="browser-file-css",t.innerHTML+=" .leaflet-control-filelayer { display: flex; } .leaflet-control-filelayer a { background: #fff url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAoklEQVQ4T2NkoBAwUqifAWyAhoq523/Gf5UohjEyvr5561QYIQvABqirmf38z/Df5tat06dhGtTVzUIZ/jOEEjIEYoCq6f6bt087otsGNWQVDlf8vnnrFBteA/A5X13N7P/NW6cYRw0YPGGgZvb7P8N/K+SERCgFqquZgdIBKzga1dTMAhj//89nYGR0IKQRJs/475/jjTtnDlAnMxFrKzZ1ALrzaRGE3tGmAAAAAElFTkSuQmCC') no-repeat 5px; background-size: 16px 16px; display: block; border-radius: 2px; }",t.innerHTML+=" .leaflet-control-filelayer a.leaflet-control-filelayer { background-position: center; }",e.appendChild(t)}});L.FileLayer={},L.FileLayer.FileLoader=e,L.FileLayer.fileLoader=function(e,t){return new L.FileLayer.FileLoader(e,t)},L.Control.FileLayerLoad=t,L.Control.fileLayerLoad=function(e){return new L.Control.FileLayerLoad(e)}}();